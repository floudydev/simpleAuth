# SimpleAuth

SimpleAuth — это простой сервер аутентификации, реализованный на Node.js с использованием Express, Sequelize и SQLite. Он предоставляет базовые функции регистрации, аутентификации, генерации JWT и управления токенами.

## Функциональность

- Регистрация пользователей
- Аутентификация пользователей
- Генерация и проверка JWT токенов
- Регистрация и обновление секретных токенов
- Ограничение запросов для защиты от атак

## Установка

1. Клонируйте репозиторий:
   ```bash
   git clone <URL репозитория>
   cd simpleAuth
   ```

2. Установите зависимости:
   ```bash
   npm install
   ```

3. Создайте файл `.env` на основе `envExm.txt`:
   ```bash
   cp envExm.txt .env
   ```

4. Убедитесь, что в `.env` указаны корректные значения:
   ```txt
   serverPort=8080
   devToken=<ваш_токен_разработчика>
   secretJWT=<ваш_секретный_ключ_JWT>
   ```

## Запуск

1. Запустите сервер в режиме разработки:
   ```bash
   npm run dev
   ```

2. Сервер будет доступен по адресу:
   ```
   http://localhost:8080
   ```

## Запуск в режиме Production

1. Соберите Docker-образ:
   ```bash
   docker-compose build
   ```

2. Запустите контейнер в режиме `production`:
   ```bash
   docker-compose up
   ```

3. Сервер будет доступен по адресу:
   ```
   http://localhost:8080
   ```

4. Остановите контейнер:
   ```bash
   docker-compose down
   ```

## API Документация

Документация API доступна по адресу:
```
http://localhost:8080/api-docs
```

### Основные маршруты

#### Пользовательские маршруты

- **POST /api/user/auth**
  - Аутентификация пользователя.
  - Параметры:
    - `token` (query): Токен пользователя (обязательный).
    - `Authorization` (header): Bearer токен (обязательный).
  - Ответы:
    - `200`: Успешная аутентификация.
    - `400`: Отсутствуют параметры.
    - `401`: Неверный формат заголовка авторизации.
    - `403`: Неверный токен.
    - `404`: Пользователь не найден.

- **POST /api/user/register**
  - Регистрация нового пользователя.
  - Параметры:
    - `name` (query): Имя пользователя (обязательный).
    - `mail` (query): Email пользователя (обязательный).
    - `password` (query): Пароль пользователя (обязательный).
  - Ответы:
    - `201`: Успешная регистрация.
    - `400`: Отсутствуют параметры.
    - `401`: Пользователь уже зарегистрирован.

- **POST /api/user/generateJWT**
  - Генерация нового JWT для пользователя.
  - Параметры:
    - `token` (query): Текущий токен пользователя (обязательный).
    - `password` (query): Пароль пользователя (обязательный).
    - `mail` (query): Email пользователя (обязательный).
  - Ответы:
    - `200`: Успешная генерация JWT.
    - `400`: Отсутствуют параметры.
    - `401`: Неверный пароль или пользователь не найден.
    - `403`: Ошибка токена.

- **POST /api/user/regenToken**
  - Перегенерация токена пользователя.
  - Параметры:
    - `password` (query): Пароль пользователя (обязательный).
    - `mail` (query): Email пользователя (обязательный).
  - Ответы:
    - `200`: Успешная перегенерация токена.
    - `400`: Отсутствуют параметры.
    - `401`: Неверный пароль или пользователь не найден.

#### Разработческие маршруты

- **POST /dev/genAdminToken**
  - Генерация временного токена администратора.
  - Заголовки:
    - `Authorization`: Токен разработчика (обязательный).
  - Ответы:
    - `201`: Успешная генерация токена.
    - `400`: Отсутствуют параметры.
    - `403`: Неверный токен разработчика.

- **POST /dev/checkToken**
  - Проверка токена.
  - Заголовки:
    - `Authorization`: Bearer токен (обязательный).
  - Ответы:
    - `200`: Успешная проверка токена.
    - `400`: Неверный формат заголовка авторизации.
    - `401`: Отсутствует заголовок авторизации.
    - `403`: Неверный токен.

## Основные зависимости

- [Express](https://expressjs.com/) — веб-фреймворк для Node.js
- [Sequelize](https://sequelize.org/) — ORM для работы с базами данных
- [SQLite](https://www.sqlite.org/) — легковесная база данных
- [jsonwebtoken](https://github.com/auth0/node-jsonwebtoken) — библиотека для работы с JWT
- [argon2](https://github.com/ranisalt/node-argon2) — библиотека для хэширования паролей

## Структура проекта

```
simpleAuth/
├── index.js                # Точка входа в приложение
├── src/
│   ├── db/
│   │   ├── db.js           # Настройка базы данных
│   │   ├── User.js         # Модель пользователя
│   ├── routes/
│   │   ├── dev.js          # Маршруты для разработчиков
│   │   ├── user.js         # Маршруты для пользователей
│   ├── utils/
│   │   ├── generateToken.js # Утилита для генерации токенов
│   ├── swagger/
│       ├── swaggerPaths.js # Swagger-документация
├── .env                    # Конфигурация окружения
├── package.json            # Зависимости и скрипты
└── README.md               # Документация проекта
```

## Лицензия

Этот проект распространяется под лицензией ISC.